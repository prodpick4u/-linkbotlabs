<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LinkBotLabs AI Video Generator</title>
<script src="https://js.puter.com/v2/"></script>
<style>
/* Background & glass effect */
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #3a0ca3, #7209b7);
    color: white;
    margin: 0;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Centered glass container */
.container {
    background: rgba(20, 20, 30, 0.85);
    padding: 30px;
    border-radius: 12px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.5);
}

/* Inputs & buttons */
input, textarea {
    width: 100%;
    padding: 10px;
    margin: 8px 0 15px 0;
    border-radius: 6px;
    border: none;
    outline: none;
    background: rgba(255,255,255,0.1);
    color: white;
}
input::placeholder, textarea::placeholder { color: #ccc; }
button {
    padding: 10px 20px;
    background: #7209b7;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
}
button:hover { background: #3a0ca3; }

/* Feedback & progress */
.error { color: #ff4d6d; }
.success { color: #00ffcc; }
.progress-container { margin-top: 10px; }
.progress-bar { width: 0%; height: 20px; background: #00ffcc; border-radius: 4px; transition: width 0.3s; }
.progress-text { margin-top: 5px; font-size: 0.9em; color: #ccc; }

/* DALL¬∑E images */
#dalle_images img { margin-bottom: 10px; width: 100%; border-radius: 6px; }

/* Video preview */
video { width: 100%; border-radius: 6px; margin-top: 15px; }

/* Password overlay */
#passwordOverlay {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 999;
}
#passwordOverlay input { width: 200px; margin-bottom: 10px; }
#pwError { color: #ff4d6d; display: none; margin-top: 5px; }
</style>
</head>
<body>

<!-- Password Overlay -->
<div id="passwordOverlay">
    <h2>üîí Enter Dashboard Password</h2>
    <input type="password" id="dashboardPassword" placeholder="Password">
    <button id="submitPassword">Submit</button>
    <p id="pwError">‚ùå Incorrect password</p>
</div>

<!-- Main Container -->
<div class="container" id="dashboardContent" style="display:none;">
    <h2>üé¨ LinkBotLabs AI Video Generator</h2>
    <div class="error" id="error"></div>
    <div class="success" id="success"></div>

    <label>Product URLs (comma separated)</label>
    <input type="text" id="urls" placeholder="https://example.com/product1, https://example.com/product2">

    <label>Optional Script / Narration</label>
    <textarea id="script" rows="4" placeholder="Optional: leave blank to auto-generate"></textarea>

    <label>Optional DALL¬∑E 3 Image Prompt</label>
    <input type="text" id="dalle_prompt" placeholder="e.g., 'Modern kitchen with kettle'">
    <button type="button" id="generateDalleBtn">Generate Image</button>
    <div id="dalle_images"></div>

    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
        <div class="progress-text" id="progressText">Idle</div>
    </div>

    <button type="button" id="generateVideoBtn">Generate Video</button>
    <video id="video_preview" controls style="display:none;"></video>
</div>

<script>
// Password functionality
const correctPassword = "supersecret";
const overlay = document.getElementById('passwordOverlay');
const input = document.getElementById('dashboardPassword');
const btn = document.getElementById('submitPassword');
const pwError = document.getElementById('pwError');
const dashboard = document.getElementById('dashboardContent');

btn.addEventListener('click', () => {
    if(input.value === correctPassword){
        overlay.style.display = 'none';
        dashboard.style.display = 'block';
    } else {
        pwError.style.display = 'block';
        input.value = '';
    }
});
input.addEventListener('keypress', e => { if(e.key==='Enter') btn.click(); });

// DALL¬∑E images
let dalleImages = [];
let generatingImage = false;
document.getElementById('generateDalleBtn').addEventListener('click', async () => {
    const prompt = document.getElementById('dalle_prompt').value.trim();
    if(!prompt) return alert('Enter a prompt');
    if(generatingImage) return alert('Please wait...');
    generatingImage = true;
    try {
        const imgEl = await puter.ai.txt2img(prompt);
        document.getElementById('dalle_images').appendChild(imgEl);
        dalleImages.push(imgEl.src);
    } catch(err){ console.error(err); alert('‚ùå Failed to generate image.'); }
    finally { generatingImage = false; }
});

// Video generation (simplified, progress messages)
document.getElementById('generateVideoBtn').addEventListener('click', async () => {
    const errorEl = document.getElementById('error');
    const successEl = document.getElementById('success');
    const videoEl = document.getElementById('video_preview');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    errorEl.textContent = '';
    successEl.textContent = '';
    videoEl.style.display = 'none';
    videoEl.src = '';
    progressBar.style.width = '0%';
    progressText.textContent = 'Starting...';

    const urls = document.getElementById('urls').value.split(',').map(u => u.trim()).filter(Boolean);
    const scriptText = document.getElementById('script').value.trim();

    if(!urls.length && !dalleImages.length) { errorEl.textContent='‚ùå Enter at least one URL or prompt.'; return; }

    try {
        progressText.textContent = 'Generating narration...';
        let finalScript = scriptText || await puter.ai.chat(
            `Write a short engaging TikTok narration for these products: ${urls.join(', ')}. Max 1600 chars.`,
            { model: "gpt-5-nano" }
        );

        progressText.textContent = 'Generating TTS...';
        const ttsBlob = await puter.ai.tts(finalScript, { voice: "alloy" });
        const ttsFile = new File([ttsBlob], "voice.mp3", { type: "audio/mpeg" });

        progressText.textContent = 'Sending to server...';
        const formData = new FormData();
        formData.append("urls", JSON.stringify([...urls, ...dalleImages]));
        formData.append("script", finalScript);
        formData.append("voiceover", ttsFile);

        const response = await fetch('/generate_video', { method:'POST', body: formData });
        const data = await response.json();

        if(data.video_file){
            progressBar.style.width='100%';
            progressText.textContent='Completed';
            successEl.textContent='‚úÖ Video generated!';
            videoEl.src=`/download/${data.video_file}`;
            videoEl.style.display='block';
        } else errorEl.textContent='‚ùå '+(data.error||'Unknown error');
    } catch(err){ console.error(err); errorEl.textContent='‚ùå Failed to generate video.'; }
});
</script>
</body>
</html>
