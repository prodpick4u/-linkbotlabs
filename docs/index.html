<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puter.js Modern Chat</title>
<script src="https://js.puter.com/v2/"></script>
<style>
body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; margin:0; padding:20px; background:#f0f4f8; }
h1 { text-align:center; color:#1a73e8; margin-bottom:20px; }
.chat-container { max-width:800px; margin:0 auto; background:white; border-radius:10px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.1); display:flex; flex-direction:column; }
#messages { flex:1; overflow-y:auto; max-height:400px; margin-bottom:12px; padding:10px; background:#e8f0fe; border-radius:6px; }
.message { padding:10px; border-radius:6px; margin:5px 0; max-width:80%; word-wrap:break-word; }
.user { background:#1a73e8; color:white; align-self:flex-end; }
.ai { background:#dbe9ff; color:#000; align-self:flex-start; }
input, select, button { width:100%; padding:12px; margin:5px 0; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; font-size:1rem; }
button { background:#1a73e8; color:white; font-weight:bold; cursor:pointer; transition:background 0.2s; }
button:hover { background:#1557b0; }
</style>
</head>
<body>

<h1>Puter.js Modern Chat</h1>

<div class="chat-container">
    <div id="messages"></div>
    <select id="modelSelect">
        <option value="gpt-5">GPT-5</option>
        <option value="gpt-5-nano">GPT-5 Nano</option>
        <option value="grok">Grok</option>
        <option value="claude">Claude</option>
        <option value="gemini">Gemini</option>
    </select>
    <input id="userInput" placeholder="Type your message here...">
    <button id="sendBtn">Send</button>
</div>

<script>
const messagesDiv = document.getElementById('messages');
const input = document.getElementById('userInput');
const modelSelect = document.getElementById('modelSelect');
const sendBtn = document.getElementById('sendBtn');

let conversation = []; // stores message history

function appendMessage(text, sender) {
    const div = document.createElement('div');
    div.className = 'message ' + sender;
    div.innerHTML = text.replace(/\n/g,'<br>');
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// ---- Send message ----
async function sendMessage() {
    const prompt = input.value.trim();
    if(!prompt) return;
    appendMessage(prompt, 'user');
    input.value = '';
    conversation.push({ role:'user', content: prompt });

    const model = modelSelect.value;
    appendMessage('Processing...', 'ai');

    try {
        const aiDiv = messagesDiv.querySelector('.ai:last-child');
        const stream = await puter.ai.chat(conversation.map(m => m.content).join('\n'), { model, stream:true });
        let fullText = '';
        for await (const part of stream) {
            fullText += part?.text || '';
            aiDiv.innerHTML = fullText.replace(/\n/g,'<br>');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        conversation.push({ role:'ai', content: fullText });
    } catch(e) {
        appendMessage('Error: ' + e.message, 'ai');
    }
}

sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keypress', e => { if(e.key === 'Enter') sendMessage(); });
</script>

</body>
</html>
