<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LinkBotLabs Products</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0d0d1a;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: turquoise;
      margin-bottom: 20px;
    }

    .affiliate-banner {
      background: #0077b6;
      color: #fff;
      padding: 12px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 20px;
      border-radius: 6px;
    }

    .category {
      margin: 40px 0;
    }

    .category h2 {
      color: #9d4edd;
      border-bottom: 2px solid turquoise;
      padding-bottom: 5px;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: #1a1a2e;
      border: 1px solid #3a3a5d;
      border-radius: 10px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
    }

    .product-card:hover {
      transform: translateY(-5px);
      border-color: turquoise;
    }

    .product-title {
      font-size: 16px;
      color: #fff;
      margin: 8px 0;
    }

    .product-price {
      color: turquoise;
      font-weight: bold;
      margin: 4px 0;
    }

    .product-desc {
      font-size: 14px;
      color: #ccc;
      margin-bottom: 8px;
    }

    .product-btn {
      margin-top: 10px;
      padding: 10px;
      background: linear-gradient(135deg, #0077b6, #00b4d8);
      border: none;
      border-radius: 6px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }

    .product-btn:hover {
      background: linear-gradient(135deg, #00b4d8, #0077b6);
    }

    .chat-box {
      margin-top: 10px;
      width: 100%;
      min-height: 100px;
      border-radius: 6px;
      padding: 8px;
      border: 1px solid #3a3a5d;
      background: #111;
      color: #fff;
      font-family: monospace;
      resize: vertical;
      display: none;
    }

    .socials {
      position: fixed;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .socials a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: turquoise;
      border-radius: 50%;
      color: #0d0d1a;
      font-weight: bold;
      text-decoration: none;
      transition: 0.3s;
    }

    .socials a:hover {
      background: #9d4edd;
      color: #fff;
    }
  </style>
</head>
<body>
  <div id="affiliate-banner" class="affiliate-banner" style="display:none;"></div>
  <h1>‚ú® LinkBotLabs Product Picks ‚ú®</h1>
  <div id="content"></div>

  <!-- Social buttons -->
  <div class="socials">
    <a href="https://www.tiktok.com/@linkbotlabs" target="_blank">TT</a>
    <a href="https://x.com/linkbotlabs" target="_blank">X</a>
    <a href="https://youtube.com/@linkbotlabs" target="_blank">YT</a>
    <a href="https://facebook.com/linkbotlabs" target="_blank">FB</a>
  </div>

  <script src="https://js.puter.com/v2/"></script>
  <script>
    const content = document.getElementById("content");

    // Get affiliate ID from URL
    function getAffiliateId() {
      const params = new URLSearchParams(window.location.search);
      return params.get("aff_id") || null;
    }

    const affiliateId = getAffiliateId();

    // Show affiliate banner if ID exists
    if (affiliateId) {
      const banner = document.getElementById("affiliate-banner");
      banner.textContent = Welcome! Your affiliate ID: ${affiliateId};
      banner.style.display = "block";
    }

    async function loadProducts() {
      try {
        const res = await fetch("products.json?cachebust=" + Date.now());
        const data = await res.json();
        renderProducts(data);
      } catch (e) {
        content.innerHTML = <p style="color:red;text-align:center;">‚ùå Failed to load products.</p>;
      }
    }

    function renderProducts(data) {
      content.innerHTML = "";
      for (const [category, items] of Object.entries(data)) {
        const section = document.createElement("div");
        section.className = "category";
        section.innerHTML = <h2>${category}</h2><div class="products-grid"></div>;
        const grid = section.querySelector(".products-grid");

        items.forEach(p => {
          const card = document.createElement("div");
          card.className = "product-card";

          card.innerHTML = 
            <h3 class="product-title">${p.title}</h3>
            <p class="product-price">${p.price}</p>
            <p class="product-desc">${p.description}</p>
            <button class="product-btn view-btn">üõí Click to View</button>
            <button class="product-btn ask-btn">üí¨ Ask GPT-4 Nano</button>
            <textarea class="chat-box" placeholder="Type your question here..."></textarea>
          ;

          // Open affiliate link on click
          card.querySelector(".view-btn").onclick = () => {
            let link = p.url;
            if (affiliateId) {
              link += (p.url.includes("?") ? "&" : "?") + "tag=" + affiliateId;
            }
            window.open(link, "_blank");
          };

          // Show/Hide chat box
          const askBtn = card.querySelector(".ask-btn");
          const chatBox = card.querySelector(".chat-box");
          askBtn.onclick = () => {
            chatBox.style.display = chatBox.style.display === "none" ? "block" : "none";
          };

          // Handle GPT chat
          chatBox.addEventListener("keydown", async (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              const lines = chatBox.value.split("\n");
              const userText = lines[lines.length-1];
              if (!userText.trim()) return;
              const response = await puter.ai.chat(userText);
              chatBox.value += \nGPT-4 Nano: ${response};
              chatBox.scrollTop = chatBox.scrollHeight;
            }
          });

          grid.appendChild(card);
        });

        content.appendChild(section);
      }
    }

    loadProducts();
  </script>
</body>
</html>
