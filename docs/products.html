<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LinkBotLabs Products</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 16px;
      line-height: 1.6;
      background: #0d0d1a;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: turquoise;
      margin-bottom: 20px;
    }

    .affiliate-banner {
      background: #0077b6;
      color: #fff;
      padding: 12px;
      text-align: center;
      font-weight: bold;
      margin-bottom: 20px;
      border-radius: 6px;
    }

    .voice-controls, .model-select {
      text-align: center;
      margin-bottom: 20px;
    }

    .voice-controls select, .voice-controls button, .model-select select {
      padding: 5px 10px;
      font-size: 16px;
      margin-right: 10px;
    }

    .category {
      margin: 40px 0;
    }

    .category h2 {
      color: #9d4edd;
      border-bottom: 2px solid turquoise;
      padding-bottom: 5px;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 25px;
    }

    .product-card {
      background: #1a1a2e;
      border: 1px solid #3a3a5d;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
    }

    .product-card:hover {
      transform: translateY(-5px);
      border-color: turquoise;
    }

    .product-title {
      font-size: 20px;
      font-weight: 600;
      margin: 10px 0;
    }

    .product-price {
      color: turquoise;
      font-weight: bold;
      margin: 6px 0;
    }

    .product-desc {
      font-size: 16px;
      line-height: 1.5;
      color: #ccc;
      margin-bottom: 12px;
    }

    .product-btn {
      margin-top: 10px;
      padding: 12px;
      background: linear-gradient(135deg, #0077b6, #00b4d8);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }

    .product-btn:hover {
      background: linear-gradient(135deg, #00b4d8, #0077b6);
    }

    .chat-box-container {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .chat-box {
      min-height: 150px;
      border-radius: 12px;
      padding: 10px;
      border: 1px solid #3a3a5d;
      background: #111;
      font-family: monospace;
      color: #fff;
      overflow-y: auto;
    }

    .chat-bubble {
      padding: 8px 12px;
      border-radius: 12px;
      margin-bottom: 6px;
      max-width: 80%;
      word-wrap: break-word;
    }

    .user-bubble {
      background: #0077b6;
      align-self: flex-end;
      color: #fff;
    }

    .ai-bubble {
      background: #9d4edd;
      align-self: flex-start;
      color: #fff;
    }

    .socials {
      position: fixed;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .socials a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: turquoise;
      border-radius: 50%;
      color: #0d0d1a;
      font-weight: bold;
      text-decoration: none;
      transition: 0.3s;
    }

    .socials a:hover {
      background: #9d4edd;
      color: #fff;
    }
  </style>
</head>
<body>
  <header style="text-align:center; padding: 15px; background:#111;">
    <img src="img_splash.jpg" alt="LinkBotLabs Logo" style="max-width:180px; display:block; margin:0 auto;">
    <h1>‚ú® LinkBotLabs Product Picks ‚ú®</h1>
  </header>

  <div id="affiliate-banner" class="affiliate-banner" style="display:none;"></div>

  <div class="voice-controls">
    <label>Select Voice:</label>
    <select id="voiceSelect"></select>
    <button id="stopTTS">‚èπ Stop</button>
  </div>

  <div class="model-select">
    <label>Select GPT Model:</label>
    <select id="modelSelect">
      <option value="gpt-5-mini">GPT-5 Mini</option>
      <option value="gpt-5">GPT-5</option>
      <option value="gpt-4o-mini">GPT-4o Mini</option>
      <option value="gpt-4-1-mini">GPT-4.1 Mini</option>
      <option value="gpt-5-nano">GPT-5 Nano</option>
    </select>
  </div>

  <div id="content"></div>

  <div class="socials">
    <a href="https://www.tiktok.com/@linkbotlabs" target="_blank">TT</a>
    <a href="https://x.com/linkbotlabs" target="_blank">X</a>
    <a href="https://youtube.com/@linkbotlabs" target="_blank">YT</a>
    <a href="https://facebook.com/linkbotlabs" target="_blank">FB</a>
  </div>

  <script src="https://js.puter.com/v2/"></script>
  <script>
    const content = document.getElementById("content");
    const modelSelect = document.getElementById("modelSelect");

    function getAffiliateId() {
      const params = new URLSearchParams(window.location.search);
      return params.get("aff_id") || null;
    }
    const affiliateId = getAffiliateId();
    if (affiliateId) {
      const banner = document.getElementById("affiliate-banner");
      banner.textContent = `Welcome! Your affiliate ID: ${affiliateId}`;
      banner.style.display = "block";
    }

    // TTS setup
    let synth = window.speechSynthesis;
    let utter;
    function populateVoiceSelects() {
      let voices = synth.getVoices();
      if (!voices.length) { setTimeout(populateVoiceSelects, 100); return; }
      const select = document.getElementById('voiceSelect');
      select.innerHTML = '';
      voices.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v.name;
        opt.textContent = v.name + ' (' + v.lang + ')';
        select.appendChild(opt);
      });
    }
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = populateVoiceSelects;
    } else populateVoiceSelects();

    function playTTS(text) {
      if (synth.speaking) synth.cancel();
      utter = new SpeechSynthesisUtterance(text);
      const selectedVoice = document.getElementById('voiceSelect').value;
      utter.voice = synth.getVoices().find(v => v.name === selectedVoice) || synth.getVoices()[0];
      synth.speak(utter);
    }
    document.getElementById('stopTTS').onclick = () => { if(synth.speaking) synth.cancel(); };

    async function loadProducts() {
      try {
        const res = await fetch("products.json?cachebust=" + Date.now());
        const data = await res.json();
        renderProducts(data);
      } catch (e) {
        content.innerHTML = `<p style="color:red;text-align:center;">‚ùå Failed to load products.</p>`;
      }
    }

    function renderProducts(data) {
      content.innerHTML = "";
      for (const [category, items] of Object.entries(data)) {
        const section = document.createElement("div");
        section.className = "category";
        section.innerHTML = `<h2>${category}</h2><div class="products-grid"></div>`;
        const grid = section.querySelector(".products-grid");

        items.forEach(p => {
          const card = document.createElement("div");
          card.className = "product-card";

          card.innerHTML = `
            <h3 class="product-title">${p.title}</h3>
            <p class="product-price">${p.price}</p>
            <p class="product-desc">${p.description}</p>
            <button class="product-btn view-btn">üõí Click to View</button>
            <button class="product-btn ask-btn">üí¨ Ask AI</button>
            <div class="chat-box-container" style="display:none;">
              <div class="chat-box" contenteditable="true"></div>
            </div>
            <button class="product-btn tts-btn">üîä Listen</button>
          `;

          const viewBtn = card.querySelector(".view-btn");
          const askBtn = card.querySelector(".ask-btn");
          const chatContainer = card.querySelector(".chat-box-container");
          const chatBox = card.querySelector(".chat-box");
          const ttsBtn = card.querySelector(".tts-btn");

          viewBtn.onclick = () => {
            let link = p.url;
            if (affiliateId) link += (p.url.includes("?") ? "&" : "?") + "tag=" + affiliateId;
            window.open(link, "_blank");
          };

          askBtn.onclick = () => {
            chatContainer.style.display = chatContainer.style.display === "none" ? "flex" : "none";
          };

          chatBox.addEventListener("keydown", async (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              const userText = chatBox.innerText.trim();
              if (!userText) return;

              const userBubble = document.createElement("div");
              userBubble.className = "chat-bubble user-bubble";
              userBubble.textContent = userText;
              chatContainer.appendChild(userBubble);

              chatBox.innerText = "";
              chatContainer.scrollTop = chatContainer.scrollHeight;

              const model = modelSelect.value;
              const response = await puter.ai.chat(userText, { model });

              const aiBubble = document.createElement("div");
              aiBubble.className = "chat-bubble ai-bubble";
              aiBubble.textContent = response;
              chatContainer.appendChild(aiBubble);
              chatContainer.scrollTop = chatContainer.scrollHeight;

              playTTS(response);
            }
          });

          ttsBtn.onclick = () => {
            const text = chatBox.innerText || p.description;
            playTTS(text);
          };

          grid.appendChild(card);
        });

        content.appendChild(section);
      }
    }

    loadProducts();
  </script>
</body>
</html>
