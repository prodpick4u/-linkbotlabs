<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Puter AI Playground</title>
<script src="https://js.puter.com/v2/"></script>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #111; color: #fff; padding: 20px; }
textarea, input[type="text"], input[type="number"] { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: none; font-size: 16px; }
button { padding: 10px 20px; font-size: 16px; border-radius: 8px; border: none; background: #0f62fe; color: #fff; cursor: pointer; margin-bottom: 20px; }
button:hover { background: #0353e9; }
img.gen { max-width: 100%; height: auto; border-radius: 10px; margin-top: 10px; }
div.out-section { margin-bottom: 30px; }
</style>
</head>
<body>

<h2>Puter AI Playground</h2>

<!-- Chat -->
<div class="out-section">
<h3>Chat</h3>
<select id="chat-model">
  <option value="gpt-4">GPT-4</option>
  <option value="gpt-3.5">GPT-3.5</option>
  <option value="gpt-4-nano">GPT-4-Nano</option>
</select>
<textarea id="chat-prompt" placeholder="Enter your question..."></textarea>
<button id="chat-run">Ask</button>
<div id="chat-out"></div>
</div>

<!-- Image Generation -->
<div class="out-section">
<h3>Image Generation</h3>
<textarea id="imggen-prompt" placeholder="Enter image prompt..."></textarea>
<label>Images per model: <input type="number" id="imggen-count" value="1" min="1" max="5"></label>
<button id="imggen-run">Generate Images</button>
<div id="imggen-out"></div>
</div>

<!-- Image Analysis -->
<div class="out-section">
<h3>Image Analysis</h3>
<select id="vision-model">
  <option value="gpt-4">GPT-4</option>
  <option value="gpt-4-nano">GPT-4-Nano</option>
</select>
<input type="text" id="vision-url" placeholder="Paste image URL here">
<textarea id="vision-prompt" placeholder="Enter analysis prompt..."></textarea>
<button id="vision-run">Analyze Image</button>
<div id="vision-out"></div>
</div>

<!-- Streaming -->
<div class="out-section">
<h3>Streaming Chat</h3>
<select id="stream-model">
  <option value="gpt-4">GPT-4</option>
  <option value="gpt-3.5">GPT-3.5</option>
</select>
<textarea id="stream-prompt" placeholder="Enter prompt for streaming..."></textarea>
<button id="stream-run">Start Stream</button>
<div id="stream-out"></div>
</div>

<script>
/* ---------- Helpers ---------- */
function putText(el, text) { el.innerHTML = (text ?? '').toString(); }
function appendText(el, text) { el.innerHTML += (text ?? '').toString(); }
function normalizeNonStream(resp) {
  if (typeof resp === 'string') return resp;
  if (resp?.output_text) return resp.output_text;
  if (resp?.text) return resp.text;
  if (resp?.message?.content) {
    if (Array.isArray(resp.message.content)) {
      const first = resp.message.content[0];
      return typeof first === 'string' ? first : (first?.text ?? JSON.stringify(first));
    }
    return typeof resp.message.content === 'string' ? resp.message.content : JSON.stringify(resp.message.content);
  }
  return JSON.stringify(resp ?? {});
}

/* ---------- CHAT ---------- */
document.getElementById('chat-run').addEventListener('click', async () => {
  const model = document.getElementById('chat-model').value;
  const prompt = document.getElementById('chat-prompt').value.trim();
  const out = document.getElementById('chat-out');
  if (!prompt) { putText(out, 'Please enter a prompt.'); return; }
  putText(out, 'Thinking…');
  try {
    const resp = await puter.ai.chat(prompt, { model });
    putText(out, normalizeNonStream(resp));
  } catch (e) { putText(out, 'Error: ' + (e?.message ?? e)); }
});

/* ---------- IMAGE GENERATION ---------- */
document.getElementById('imggen-run').addEventListener('click', async () => {
  const prompt = document.getElementById('imggen-prompt').value.trim();
  const out = document.getElementById('imggen-out');
  const count = parseInt(document.getElementById('imggen-count')?.value, 10) || 1;
  if (!prompt) { putText(out, 'Please enter an image prompt.'); return; }

  out.innerHTML = '';
  const models = ['dalle', 'stable-diffusion', 'openjourney', 'anything-v4'];
  const placeholders = [];

  models.forEach(model => {
    const wrapper = document.createElement('div');
    const label = document.createElement('p');
    label.textContent = `Model: ${model}`;
    label.style.fontWeight = 'bold';
    const loading = document.createElement('p');
    loading.textContent = 'Loading…';
    wrapper.appendChild(label);
    wrapper.appendChild(loading);
    out.appendChild(wrapper);
    placeholders.push({ wrapper, loading, model });
  });

  await Promise.all(placeholders.map(async p => {
    try {
      for (let i = 0; i < count; i++) {
        const imgEl = await puter.ai.txt2img(prompt, { model: p.model });
        imgEl.classList.add('gen');
        p.wrapper.appendChild(imgEl);
      }
      p.wrapper.removeChild(p.loading);
    } catch (e) {
      p.loading.textContent = `Failed: ${e?.message ?? 'Unknown error'}`;
      console.warn(`Model ${p.model} failed:`, e);
    }
  }));
});

/* ---------- IMAGE ANALYSIS ---------- */
document.getElementById('vision-run').addEventListener('click', async () => {
  const model = document.getElementById('vision-model').value;
  const url = document.getElementById('vision-url').value.trim();
  const prompt = document.getElementById('vision-prompt').value.trim();
  const out = document.getElementById('vision-out');
  if (!url) { putText(out, 'Please paste a direct image URL.'); return; }
  if (!prompt) { putText(out, 'Please enter a prompt.'); return; }

  putText(out, 'Analyzing image…');
  try {
    const resp = await puter.ai.chat(prompt, url, { model });
    putText(out, normalizeNonStream(resp));
  } catch (e) { putText(out, 'Error: ' + (e?.message ?? e)); }
});

/* ---------- STREAMING ---------- */
document.getElementById('stream-run').addEventListener('click', async () => {
  const model = document.getElementById('stream-model').value;
  const prompt = document.getElementById('stream-prompt').value.trim();
  const out = document.getElementById('stream-out');
  if (!prompt) { putText(out, 'Please enter a prompt.'); return; }

  putText(out, '');
  try {
    const stream = await puter.ai.chat(prompt, { model, stream: true });
    for await (const part of stream) {
      if (part?.output_text) appendText(out, part.output_text.replaceAll('\n','<br>'));
      else if (part?.text) appendText(out, part.text.replaceAll('\n','<br>'));
    }
  } catch (e) { putText(out, 'Error: ' + (e?.message ?? e)); }
});
</script>

</body>
</html>
