<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Playground</title>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    :root {
      --glass: rgba(0,0,0,0.35);
      --stroke: rgba(255,255,255,0.12);
      --text: #fff;
      --muted: #cfcfcf;
      --accent: #ffe169;
      --loading: rgba(255,255,255,0.2);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      padding: 24px;
      color: var(--text);
      background: radial-gradient(1200px 1200px at 10% -10%, #111 0%, #000 60%, #000 100%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }
    h1 { margin: 0 0 18px 0; font-weight: 700; letter-spacing: .2px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 18px;
    }
    .card {
      grid-column: span 12;
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    @media (min-width: 900px) {
      .card { grid-column: span 6; }
    }
    label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin: 8px 0 6px;
    }
    textarea, input, select {
      width: 100%;
      color: var(--text);
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--stroke);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
      caret-color: var(--text);
    }
    textarea { min-height: 84px; resize: vertical; }
    button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--accent);
      color: #000;
      font-weight: 700;
      border: 0;
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:disabled {
      background: var(--loading);
      cursor: not-allowed;
    }
    .output {
      margin-top: 12px;
      padding: 12px;
      border-radius: 10px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--stroke);
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    img.gen {
      max-width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
      margin-top: 10px;
    }
    .hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }
    .button-group { display: flex; gap: 10px; }
  </style>
</head>
<body>
  <h1>AI Playground</h1>
  <div class="grid">
    <!-- CHAT / Q&A -->
    <div class="card" id="card-chat">
      <h2 style="margin:0 0 6px">Chat / Q&amp;A</h2>
      <div class="hint">Ask anything. Supports speech output and conversation saving.</div>
      <label for="chat-model">Model</label>
      <select id="chat-model"></select>
      <label for="chat-prompt">Prompt</label>
      <textarea id="chat-prompt" placeholder="e.g., Explain quantum computing in simple terms"></textarea>
      <div class="button-group">
        <button id="chat-run">Run</button>
        <button id="chat-speak">Speak</button>
        <button id="chat-save">Save</button>
        <button id="chat-load">Load</button>
      </div>
      <div class="output" id="chat-out"></div>
    </div>

    <!-- IMAGE GENERATION -->
    <div class="card" id="card-imggen">
      <h2 style="margin:0 0 6px">Image Generation</h2>
      <div class="hint">Generate images from text (DALL¬∑E via Puter.js).</div>
      <label for="imggen-model">Model</label>
      <select id="imggen-model"></select>
      <label for="imggen-prompt">Image Prompt</label>
      <textarea id="imggen-prompt" placeholder="e.g., A futuristic cityscape at night with neon rain"></textarea>
      <label for="imggen-count">Number of Images</label>
      <select id="imggen-count">
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
      <button id="imggen-run">Generate</button>
      <div class="output" id="imggen-out"></div>
    </div>

    <!-- IMAGE ANALYSIS -->
    <div class="card" id="card-vision">
      <h2 style="margin:0 0 6px">Image Analysis</h2>
      <div class="hint">Paste an image URL and ask a question about it.</div>
      <label for="vision-model">Model</label>
      <select id="vision-model"></select>
      <label for="vision-url">Image URL</label>
      <input id="vision-url" placeholder="https://‚Ä¶ (direct image link)" />
      <label for="vision-prompt">Prompt</label>
      <textarea id="vision-prompt">What do you see in this image?</textarea>
      <div class="button-group">
        <button id="vision-run">Analyze</button>
        <button id="vision-speak">Speak</button>
      </div>
      <div class="output" id="vision-out"></div>
    </div>

    <!-- STREAMING LONG RESPONSES -->
    <div class="card" id="card-stream">
      <h2 style="margin:0 0 6px">Streaming (Long Responses)</h2>
      <div class="hint">See responses arrive in real-time.</div>
      <label for="stream-model">Model</label>
      <select id="stream-model"></select>
      <label for="stream-prompt">Prompt</label>
      <textarea id="stream-prompt">Explain the theory of relativity in detail.</textarea>
      <div class="button-group">
        <button id="stream-run">Stream</button>
        <button id="stream-speak">Speak</button>
      </div>
      <div class="output" id="stream-out"></div>
    </div>
  </div>

  <script>
    /* ---------- Configuration ---------- */
    const MODEL_LIST = {
      chat: [
        { id: "x-ai/grok-3", name: "Grok 3" },
        { id: "x-ai/grok-3-mini", name: "Grok 3 Mini" },
        { id: "gpt-4.1-nano", name: "GPT-4.1-nano (fast & light)" },
        { id: "gpt-4.1", name: "GPT-4.1" },
        { id: "gpt-4o", name: "GPT-4o" },
        { id: "claude-sonnet-4", name: "Claude Sonnet 4" },
        { id: "google/gemini-2.0-flash-001", name: "Gemini 2.0 Flash" }
      ],
      image: [
        { id: "dalle", name: "DALL¬∑E 3 (default)" },
        { id: "stable-diffusion", name: "Stable Diffusion" }
      ],
      vision: [
        { id: "x-ai/grok-3", name: "Grok 3" },
        { id: "gpt-4o", name: "GPT-4o (vision)" },
        { id: "gpt-4.1", name: "GPT-4.1" },
        { id: "claude-sonnet-4", name: "Claude Sonnet 4" }
      ],
      stream: [
        { id: "x-ai/grok-3", name: "Grok 3" },
        { id: "gpt-4.1-nano", name: "GPT-4.1-nano" },
        { id: "gpt-4o", name: "GPT-4o" },
        { id: "claude-sonnet-4", name: "Claude Sonnet 4" }
      ]
    };

    /* ---------- Helpers ---------- */
    function putText(el, text) {
      el.innerHTML = (text ?? '').toString();
    }

    function appendText(el, text) {
      el.innerHTML += (text ?? '').toString();
    }

    function normalizeNonStream(resp) {
      if (typeof resp === 'string') return resp;
      if (resp?.output_text) return resp.output_text;
      if (resp?.text) return resp.text;
      if (resp?.message?.content) {
        if (Array.isArray(resp.message.content)) {
          const first = resp.message.content[0];
          return typeof first === 'string' ? first : (first?.text ?? JSON.stringify(resp.message.content));
        }
        return typeof resp.message.content === 'string' ? resp.message.content : JSON.stringify(resp.message.content);
      }
      return JSON.stringify(resp ?? {});
    }

    function setLoading(button, isLoading) {
      button.disabled = isLoading;
      button.textContent = isLoading ? 'Processing‚Ä¶' : button.dataset.originalText;
    }

    <script>
async function speakText(text) {
  if (!text) return;

  const lang = document.getElementById("speech-lang").value;
  const voiceChoice = document.getElementById("speech-voice").value;

  // Web Speech API fallback
  if ('speechSynthesis' in window) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;

    // Optional: choose voice
    const voices = speechSynthesis.getVoices();
    if (voiceChoice === "female") {
      utterance.voice = voices.find(v => v.name.toLowerCase().includes("female")) || voices[0];
    } else if (voiceChoice === "male") {
      utterance.voice = voices.find(v => v.name.toLowerCase().includes("male")) || voices[0];
    } else {
      utterance.voice = voices[0];
    }

    speechSynthesis.speak(utterance);
    console.log("üîä Speaking:", text);
  } else {
    console.warn("‚ùå Speech synthesis not supported in this browser");
    alert("Speech synthesis not supported in this browser");
  }
}
</script>
      }
    }

    function populateDropdown(selectId, models) {
      const select = document.getElementById(selectId);
      select.innerHTML = '';
      models.forEach(model => {
        const option = document.createElement('option');
        option.value = model.id;
        option.textContent = model.name;
        select.appendChild(option);
      });
    }

    function saveConversation(id, prompt, response) {
      const conversations = JSON.parse(localStorage.getItem('conversations') || '{}');
      conversations[id] = { prompt, response, timestamp: new Date().toISOString() };
      localStorage.setItem('conversations', JSON.stringify(conversations));
    }

    function loadConversation(id, promptEl, outEl) {
      const conversations = JSON.parse(localStorage.getItem('conversations') || '{}');
      const convo = conversations[id];
      if (convo) {
        promptEl.value = convo.prompt;
        putText(outEl, convo.response);
      }
    }

    /* ---------- Initialize Dropdowns ---------- */
    function initializeDropdowns() {
      populateDropdown('chat-model', MODEL_LIST.chat);
      populateDropdown('imggen-model', MODEL_LIST.image);
      populateDropdown('vision-model', MODEL_LIST.vision);
      populateDropdown('stream-model', MODEL_LIST.stream);
    }

    /* ---------- Event Listeners ---------- */
    function setupEventListeners() {
      // Store original button texts
      document.querySelectorAll('button').forEach(btn => {
        btn.dataset.originalText = btn.textContent;
      });

      // Chat
      document.getElementById('chat-run').addEventListener('click', async () => {
        const button = document.getElementById('chat-run');
        const model = document.getElementById('chat-model').value;
        const prompt = document.getElementById('chat-prompt').value.trim();
        const out = document.getElementById('chat-out');
        if (!prompt) { putText(out, 'Please enter a prompt.'); return; }
        setLoading(button, true);
        putText(out, 'Thinking‚Ä¶');
        try {
          const resp = await puter.ai.chat(prompt, { model });
          const text = normalizeNonStream(resp);
          putText(out, text);
          saveConversation('chat', prompt, text);
        } catch (e) {
          putText(out, 'Error: ' + (e?.message ?? e));
        } finally {
          setLoading(button, false);
        }
      });

      document.getElementById('chat-speak').addEventListener('click', () => {
        const out = document.getElementById('chat-out').textContent;
        if (out && out !== 'Thinking‚Ä¶' && !out.startsWith('Error:')) {
          speakText(out);
        }
      });

      document.getElementById('chat-save').addEventListener('click', () => {
        const prompt = document.getElementById('chat-prompt').value.trim();
        const out = document.getElementById('chat-out').textContent;
        if (prompt && out && !out.startsWith('Error:')) {
          saveConversation('chat', prompt, out);
          alert('Conversation saved!');
        }
      });

      document.getElementById('chat-load').addEventListener('click', () => {
        loadConversation('chat', document.getElementById('chat-prompt'), document.getElementById('chat-out'));
      });

      // Image Generation
      document.getElementById('imggen-run').addEventListener('click', async () => {
        const button = document.getElementById('imggen-run');
        const model = document.getElementById('imggen-model').value;
        const prompt = document.getElementById('imggen-prompt').value.trim();
        const out = document.getElementById('imggen-out');
        const count = parseInt(document.getElementById('imggen-count').value, 10) || 1;
        if (!prompt) { putText(out, 'Please enter an image prompt.'); return; }
        setLoading(button, true);
        putText(out, 'Generating‚Ä¶');
        out.innerHTML = '';
        try {
          for (let i = 0; i < count; i++) {
            const imgEl = await puter.ai.txt2img(prompt, { model });
            imgEl.classList.add('gen');
            out.appendChild(imgEl);
          }
        } catch (e) {
          putText(out, 'Error: ' + (e?.message ?? e));
        } finally {
          setLoading(button, false);
        }
      });

      // Image Analysis
      document.getElementById('vision-run').addEventListener('click', async () => {
        const button = document.getElementById('vision-run');
        const model = document.getElementById('vision-model').value;
        const url = document.getElementById('vision-url').value.trim();
        const prompt = document.getElementById('vision-prompt').value.trim();
        const out = document.getElementById('vision-out');
        if (!url) { putText(out, 'Please paste a direct image URL.'); return; }
        if (!prompt) { putText(out, 'Please enter a prompt.'); return; }
        setLoading(button, true);
        putText(out, 'Analyzing image‚Ä¶');
        try {
          const resp = await puter.ai.chat(prompt, url, { model });
          const text = normalizeNonStream(resp);
          putText(out, text);
          saveConversation('vision', prompt, text);
        } catch (e) {
          putText(out, 'Error: ' + (e?.message ?? e));
        } finally {
          setLoading(button, false);
        }
      });

      document.getElementById('vision-speak').addEventListener('click', () => {
        const out = document.getElementById('vision-out').textContent;
        if (out && out !== 'Analyzing image‚Ä¶' && !out.startsWith('Error:')) {
          speakText(out);
        }
      });

      // Streaming
      document.getElementById('stream-run').addEventListener('click', async () => {
        const button = document.getElementById('stream-run');
        const model = document.getElementById('stream-model').value;
        const prompt = document.getElementById('stream-prompt').value.trim();
        const out = document.getElementById('stream-out');
        if (!prompt) { putText(out, 'Please enter a prompt.'); return; }
        setLoading(button, true);
        putText(out, '');
        try {
          const stream = await puter.ai.chat(prompt, { model, stream: true });
          let fullText = '';
          for await (const part of stream) {
            const text = part?.output_text || part?.text || '';
            appendText(out, text.replaceAll('\n', '<br>'));
            fullText += text;
          }
          saveConversation('stream', prompt, fullText);
        } catch (e) {
          putText(out, 'Error: ' + (e?.message ?? e));
        } finally {
          setLoading(button, false);
        }
      });

      document.getElementById('stream-speak').addEventListener('click', () => {
        const out = document.getElementById('stream-out').textContent;
        if (out && !out.startsWith('Error:')) {
          speakText(out);
        }
      });
    }

    /* ---------- Initialization ---------- */
    initializeDropdowns();
    setupEventListeners();
  </script>
</body>
</html>
