<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puter AI Chat Streaming with Voices</title>
<script src="https://js.puter.com/v2/"></script>
<style>
  html, body { margin:0; padding:0; height:100%; font-family:Segoe UI,sans-serif; background:#111; color:#fff; }
  #container { display:flex; flex-direction:column; height:100%; }
  #chat-box { flex:1; overflow-y:auto; padding:10px; border-bottom:1px solid #333; }
  #input-area { display:flex; flex-wrap:wrap; padding:10px; background:#222; align-items:center; }
  #input { flex:1; padding:8px; border:none; border-radius:4px; font-size:14px; margin-right:6px; }
  button, select { margin-left:6px; margin-top:6px; padding:6px 10px; border:none; border-radius:4px; background:#444; color:#fff; font-size:14px; }
  #debug-console { background:#111; color:#0f0; font-size:12px; padding:5px; max-height:150px; overflow-y:auto; border-top:1px solid #333; font-family:monospace; }
  .ai-msg { color:#0ff; }
</style>
</head>
<body>
<div id="container">
  <div id="chat-box"></div>
  <div id="input-area">
    <input id="input" placeholder="Type a message..." />
    <button id="send-btn">Send</button>
    <button id="speak-btn">🔊 Speak</button>
    <select id="model-select"></select>
    <select id="voice-select"></select>
  </div>
  <div id="debug-console"></div>
</div>

<script>
// Elements
const chatBox = document.getElementById('chat-box');
const inputEl = document.getElementById('input');
const modelSelect = document.getElementById('model-select');
const voiceSelect = document.getElementById('voice-select');
const debug = document.getElementById('debug-console');

// Utilities
function appendChat(msg, cls="") { 
  const div = document.createElement("div");
  if(cls) div.className = cls;
  div.innerHTML = msg; 
  chatBox.appendChild(div); 
  chatBox.scrollTop = chatBox.scrollHeight; 
}
function logDebug(msg) { 
  if(typeof msg==="object") msg = JSON.stringify(msg, null,2);
  debug.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
  debug.scrollTop = debug.scrollHeight; 
}

// Models dropdown
const models = ["meta-llama/llama-4-scout","mistral-7b","mistral-instruct","openai:gpt-4o-mini","openai:gpt-4o","openai:gpt-3.5-turbo"];
models.forEach(m => modelSelect.add(new Option(m,m)));

// Voices dropdown
const voices = [
  {name:"Moirai (en_ie)", engine:"neural", language:"en-IE"},
  {name:"Emma (en_us)", engine:"neural", language:"en-US"},
  {name:"Liam (en_us)", engine:"neural", language:"en-US"},
  {name:"Sophia (en_uk)", engine:"neural", language:"en-GB"},
  {name:"Default", engine:"standard", language:"en-US"}
];
voices.forEach(v => voiceSelect.add(new Option(v.name, JSON.stringify(v))));

// Send message with streaming
async function sendChat() {
  const prompt = inputEl.value.trim();
  const model = modelSelect.value;
  if(!prompt){ appendChat("Enter a message."); return; }
  appendChat(`<b>You:</b> ${prompt}`);
  inputEl.value = "";

  if(!window.puter || !puter.ai){ appendChat("⚠️ puter.js missing!"); logDebug("puter.js not loaded."); return; }

  try {
    const streamDiv = document.createElement("div");
    streamDiv.className = "ai-msg";
    chatBox.appendChild(streamDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    await puter.ai.chatStream(prompt, { model }, (partial) => {
      streamDiv.innerHTML = `<b>AI:</b> ${partial}`;
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    logDebug(`✅ Chat streamed successfully for ${model}`);
  } catch(e) {
    appendChat("❌ Chat error. See debug console.");
    logDebug(`❌ Chat error: ${JSON.stringify(e,null,2)}`);
  }
}

// TTS
async function speakText() {
  if(!window.puter || !puter.ai){ logDebug("puter.js not loaded."); return; }
  const text = chatBox.innerText;
  if(!text) return;
  const voice = JSON.parse(voiceSelect.value);
  try {
    const audio = await puter.ai.txt2speech(text, voice);
    audio.play();
    logDebug(`🔊 TTS played successfully with ${voice.name}.`);
  } catch(e) {
    logDebug(`❌ TTS error: ${JSON.stringify(e,null,2)}`);
  }
}

// Event listeners
document.getElementById('send-btn').addEventListener('click', sendChat);
document.getElementById('speak-btn').addEventListener('click', speakText);
inputEl.addEventListener('keypress', e => { if(e.key==='Enter') sendChat(); });
</script>
</body>
</html>
