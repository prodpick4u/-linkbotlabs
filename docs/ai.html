<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LinkBotLabs Free AI Chat</title>
<script src="https://js.puter.com/v2/"></script>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin:0;
    padding:0;
    height:100vh;
    display:flex;
    flex-direction:column;
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    color:#fff;
  }
  #chat {
    flex:1;
    overflow-y:auto;
    padding:15px;
    backdrop-filter: blur(8px);
  }
  #input-area {
    display:flex;
    flex-wrap:wrap;
    padding:10px;
    background: rgba(20,20,30,0.7);
    backdrop-filter: blur(8px);
  }
  #input {
    flex:1;
    padding:8px;
    border:none;
    border-radius:5px;
    font-size:14px;
    margin-right:6px;
  }
  select, button {
    margin:4px 6px 4px 0;
    padding:6px 10px;
    border:none;
    border-radius:4px;
    background: #444;
    color:#fff;
    font-size:14px;
  }
  #debug-log {
    background: rgba(0,0,0,0.7);
    color:#0f0;
    font-family: monospace;
    font-size:12px;
    max-height:150px;
    overflow-y:auto;
    padding:5px;
  }
  p {
    margin:5px 0;
  }
</style>
</head>
<body>
<div id="chat"></div>

<div id="input-area">
  <select id="model">
    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
    <option value="gpt-4o-mini">GPT-4o Mini</option>
    <option value="gpt-4o-micro">GPT-4o Micro</option>
    <option value="gpt-4o-tiny">GPT-4o Tiny</option>
    <option value="gpt-4o-nano">GPT-4o Nano</option>
    <option value="x-ai/grok-4">Grok 4</option>
    <option value="x-ai/grok-3">Grok 3</option>
    <option value="x-ai/grok-2">Grok 2</option>
    <option value="claude-1">Claude 1</option>
    <option value="claude-2">Claude 2</option>
    <option value="gemini-1">Gemini 1</option>
    <option value="deepseek-1">DeepSeek 1</option>
    <option value="llama-4-scout:free">LLaMA Scout</option>
  </select>

  <input id="input" placeholder="Type your message...">
  <button onclick="sendMessage()">Send</button>

  <select id="speech-lang">
    <option value="en">English</option>
    <option value="en-ie">English (Ireland)</option>
    <option value="en-us">English (US)</option>
  </select>
  <select id="speech-engine">
    <option value="moirai">Moirai</option>
    <option value="openai">OpenAI</option>
  </select>
  <select id="speech-voice">
    <option value="default">Default</option>
    <option value="female">Female</option>
    <option value="male">Male</option>
  </select>
</div>

<div id="debug-log"></div>

<script>
function logDebug(...args) {
  const logBox = document.getElementById("debug-log");
  const msg = args.map(a => typeof a === "object" ? JSON.stringify(a,null,2) : a).join(" ");
  logBox.innerHTML += msg + "<br>";
  logBox.scrollTop = logBox.scrollHeight;
  console.log(...args);
}

function putText(container,text,sender="ai") {
  const p = document.createElement("p");
  p.textContent = (sender==="user"?"üßë: ":"ü§ñ: ") + text;
  container.appendChild(p);
  container.scrollTop = container.scrollHeight;
}

function normalizeNonStream(resp) {
  if(!resp) return "";
  if(typeof resp==="string") return resp;
  if(resp.output_text) return resp.output_text;
  if(resp.message?.content) return resp.message.content;
  if(resp.message) return resp.message;
  if(resp.text) return resp.text;
  if(resp.choices && resp.choices[0]?.message?.content) return resp.choices[0].message.content;
  return "[No text output found]";
}

async function sendMessage() {
  const input = document.getElementById("input");
  const text = input.value.trim();
  if(!text) return;
  input.value="";
  const chatBox = document.getElementById("chat");
  putText(chatBox,text,"user");

  const model = document.getElementById("model").value;
  logDebug("üöÄ Sending message:", text, "model:", model);

  try {
    const resp = await puter.ai.chat(text,{model});
    logDebug("üì• Raw AI response:", resp);
    const out = normalizeNonStream(resp);
    putText(chatBox,out,"ai");
    speakText(out);
  } catch(e) {
    logDebug("üí• Chat error:", e);
    putText(chatBox,"[Error: "+(e.message??e)+"]","ai");
  }
}

async function speakText(text){
  if(!text) return;
  const lang = document.getElementById("speech-lang").value;
  const engine = document.getElementById("speech-engine").value;
  const voice = document.getElementById("speech-voice").value;

  logDebug("üîä Requesting speech:",{text,lang,engine,voice});

  try{
    const result = await puter.ai.txt2speech(text,{language:lang,engine,voice});
    logDebug("‚úÖ TTS raw result:",result);
    if(result instanceof HTMLAudioElement){ result.play(); return; }
    if(result?.audio instanceof Blob){ const url = URL.createObjectURL(result.audio); new Audio(url).play(); return; }
    if(typeof result==="string"){ new Audio(result).play(); return; }
    logDebug("‚ùå Unsupported TTS return format:",result);
    alert("Speech output not supported. See debug log below.");
  }catch(e){
    logDebug("üí• TTS error:",e);
    alert("Speech failed: "+(e.message??e));
  }
}
</script>
</body>
</html>
