name: Test MoviePy Installation

on:
  workflow_dispatch:

jobs:
  test-moviepy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.12

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install moviepy imageio imageio-ffmpeg

      - name: Install system dependencies for MoviePy
        run: |
          sudo apt update
          sudo apt install -y ffmpeg libx11-dev imagemagick

      - name: Test MoviePy TextClip
        run: |
          echo "from moviepy.editor import TextClip; TextClip('Test', fontsize=50, color='white', size=(640, 480)).write_videofile('test.mp4', fps=24)" > test.py
          python test.py

      - name: Upload generated test video
        uses: actions/upload-artifact@v4
        with:
          name: moviepy-test-video
          path: test.mp4
